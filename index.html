<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        margin: 0;
        padding: 0;
        height: 100%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script src="https://js.leapmotion.com/0.2.0/leap.min.js"></script>
    <script>
var map;
var lastHand;

var separationStart;

function move(frame) {
    // if there is one hand grabbing...
    if(frame.pointables.length == 0 && frame.hands.length == 1) {
      var hand = frame.hands[0];
      
      // If there was no previous closed position, capture it and exit
      if(lastHand == null) {
        lastHand = hand.palmPosition;
        // console.log("Setting lastHand: " + lastHand);
        return;
      }

      // Calculate how much the hand moved
      var dX = lastHand[0] - hand.palmPosition[0];
      var dY = lastHand[1] - hand.palmPosition[1];
      // console.log("Movement: " + dX + ","+dY);

      var center = map.getCenter();

      var scaling = 4.0 / Math.pow(2, map.getZoom()-1);

      var newLat = center.lat() + dY * scaling;
      var newLng = center.lng() + dX * scaling;

      var newCenter = new google.maps.LatLng(newLat, newLng);

      // console.log(newCenter)

      map.setCenter(newCenter);

      lastHand = hand.palmPosition;

    } else
          // if there is two hands grabbing...
          if(frame.pointables.length == 0 && frame.hands.length == 2) {
      var leftHand = frame.hands[0].palmPosition;
      var rightHand = frame.hands[1].palmPosition;

      var separation = Math.sqrt(
                          Math.pow(rightHand[0] - leftHand[0], 2) + 
                          Math.pow(rightHand[1] - leftHand[1], 2)
                        );
      console.log("separation = " + separation + " ("+separationStart+")");

        if(separationStart == null) {
          separationStart = separation;

          return;
        }

        var currentZoom = map.getZoom();

        if(currentZoom > 1 && separation < separationStart / 2) {
          map.setZoom( currentZoom - 1 );
          separationStart = separation;
        } else if( currentZoom < 15 && separation > 2 * separationStart ) {
          map.setZoom( currentZoom + 1 );
          separationStart = separation;
        }


    } else {
      // If the left hand is not in a grab position, clear the last hand position
      if(frame.hands.length > 0 && frame.hands[0].pointables.length > 0 && lastHand != null) {
        lastHand = null;
      }

      // if the right hand is not in a grab position, clear the separation
      if(frame.hands.length > 1 && frame.hands[0].pointables.length > 0 && separationStart != null) {
        separationStart = null;
      }
       // console.log("Clearing lastHand");
    }
};

function initialize() {
  var mapOptions = {
    zoom: 8,
    center: new google.maps.LatLng(-34.397, 150.644),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  // listen to Leap Motion
  Leap.loop(move);
}



google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>